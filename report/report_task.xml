<?xml version="1.0" encoding="UTF-8"?>
<!--Para que el informe funcione corecctamente hay que poner secuencias a las tareas (SI==100) (NO==110) (BIEN == 130) (REGULA==140) (MAL == 150)-->
<openerp>
    <data>
      <!--Creo la opcion de imprimir en ela pantalla de proyectos-->
         <report id="task_report"
               string="Project task report"
               model="project.project"
               name="report_project_task.check_task_report"
               report_type="qweb-pdf"/>

    <template id="check_task_report">
        <t t-call="report.html_container">
          <t t-foreach="docs" t-as="o">
            <div class="col-xs-6 col-xs-offset-1">
            <t t-call="report.external_layout"></t>
            </div>
            <div class="page">

            <!--Empieza la portada-->
            <div class="oe_structure">

            <div >
              <h1 style="text-align:center; font-weight: bold;"> Protoclo de inspección y mantenimiento</h1>
              <!--Hay que añadir na imagen en report_project_task/static/src/img/ con el nombre imagen-portadajpg"-->
              <img style="display: block;margin-left: auto;margin-right: auto" class="img img-responsive mt32" src="report_project_task/static/src/img/imagen-portada.jpg"/>
              </div>
            </div>
            <p style="page-break-after: always;"></p>
            <!--Final Portada-->

            <div class="oe_structure">
            <div class="col-xs-9 mt16" style="background:#FF0000">
              <h3 style="font-weight: bold; font-style:italic; margin-top:0; margin-bottom:0; color:#FFFFFF;">
              <span > PROTOCOLO DE INSPECCIÓN PARA G.E. </span>
              </h3>
            </div>

            <div class="row zero_min_height">
              <div class="col-xs-12">
                <div style="border-bottom: 1px solid #FF0000;"/>
              </div>
            </div>

            <div class="row mt32 mb32">
              <div class="col-xs-6">
                <div t-field="o.partner_id" t-field-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;, &quot;fax&quot;], &quot;no_marker&quot;: true}"/>
              </div>
              <div class="col-xs-6 pull-right" style="background:#D8D8D8;">
                <table class="table table-condensed" >
                  <tr class="border-black">
                  <div t-field="o.partner_id" t-field-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;, &quot;fax&quot;], &quot;no_marker&quot;: true}"/>
                  </tr>
                </table>
              </div>
            </div>

            <div>
              <table style="width:100%;" >
                <h4 style="font-weight: bold; font-style:italic; margin-top:0; margin-bottom:0;">
                <tr>

                  <td style="width:15%">      
                     <span > Revisión </span>
                  </td>

                  <td style="align:center; width:5%" t-foreach="o.type_ids" t-as="c">
                    <span t-field="c.name"/>
                  </td>

                  <td style="width:20%">      
                     <span > Comentarios </span>
                  </td>

                </tr>
                </h4>
              </table>           
              

            </div>

            <div class="row zero_min_height">
              <div class="col-xs-12">
                <div style="border-bottom: 1px solid #FF0000;"/>
              </div>
            </div>


          <span style="font-weight: bold;">ADMISIÓN Y ESCAPE</span>
           <t t-foreach="o.tasks" t-as="t">
           <t t-if="t.categ_ids.name == 'admision'"> 
           <table style="width:100%;" >
              <tr>
                <td style="width:15%">
                <span t-field="t.name"/>
                </td>
                <!--TODO: Consefuir el total de etaps que tiene el proyecto-->
                <t t-set="p" t-value="5" />

                <td style="align:left; width:5%" t-foreach="o.type_ids" t-as="c">

                  <!--SI-->
                  <t t-if="p == 5">
                    <t t-if=" t.stage_id.name == 'SI'">
                      <input type="checkbox" name="stage" value="checked" checked="checked"/>
                    </t>
                    <t t-if="p == 5 and t.stage_id.name != 'SI'">
                    <input type="checkbox" name="stage"/>
                    </t>
                  </t>
                  <!--NO-->
                  <t t-if="p == 4">
                    <t t-if=" t.stage_id.name == 'NO'">
                      <input type="checkbox" name="stage" value="checked" checked="checked"/>
                    </t>
                    <t t-if="p == 4 and t.stage_id.name != 'NO'">
                    <input type="checkbox" name="stage"/>
                    </t>
                  </t>
                  <!--BIEN-->
                  <t t-if="p == 3">
                    <t t-if=" t.stage_id.name == 'BIEN'">
                      <input type="checkbox" name="stage" value="checked" checked="checked"/>
                    </t>
                    <t t-if="p == 3 and t.stage_id.name != 'BIEN'">
                    <input type="checkbox" name="stage"/>
                    </t>
                  </t>
                  <!--REGULAR-->
                  <t t-if="p == 2">
                    <t t-if=" t.stage_id.name == 'REG'">
                      <input type="checkbox" name="stage" value="checked" checked="checked"/>
                    </t>
                    <t t-if="p == 2 and t.stage_id.name != 'REG'">
                    <input type="checkbox" name="stage"/>
                    </t>
                  </t>
                  <!--MAL-->
                  <t t-if="p == 1">
                    <t t-if=" t.stage_id.name == 'MAL'">
                      <input type="checkbox" name="stage" value="checked" checked="checked"/>
                    </t>
                    <t t-if="p == 1 and t.stage_id.name != 'MAL'">
                    <input type="checkbox" name="stage"/>
                    </t>
                  </t>

                  <t t-set="p" t-value=" p - 1" />
                </td>

                <td style="width:20%">
                  <span t-field="t.description"/>
                </td>
              </tr>
            </table>
            </t>
            </t>

            <span style="font-weight: bold;">REFRIGERACIÓN</span>
           <t t-foreach="o.tasks" t-as="t">
           <t t-if="t.categ_ids.name == 'REFRIGERACION'"> 
           <table style="width:100%;" >
              <tr>
                <td style="width:15%">
                <span t-field="t.name"/>
                </td>
                <!--TODO: Consefuir el total de etaps que tiene el proyecto-->
                <t t-set="p" t-value="5" />

                <td style="align:left; width:5%" t-foreach="o.type_ids" t-as="c">

                  <!--SI-->
                  <t t-if="p == 5">
                    <t t-if=" t.stage_id.name == 'SI'">
                      <input type="checkbox" name="stage" value="checked" checked="checked"/>
                    </t>
                    <t t-if="p == 5 and t.stage_id.name != 'SI'">
                    <input type="checkbox" name="stage"/>
                    </t>
                  </t>
                  <!--NO-->
                  <t t-if="p == 4">
                    <t t-if=" t.stage_id.name == 'NO'">
                      <input type="checkbox" name="stage" value="checked" checked="checked"/>
                    </t>
                    <t t-if="p == 4 and t.stage_id.name != 'NO'">
                    <input type="checkbox" name="stage"/>
                    </t>
                  </t>
                  <!--BIEN-->
                  <t t-if="p == 3">
                    <t t-if=" t.stage_id.name == 'BIEN'">
                      <input type="checkbox" name="stage" value="checked" checked="checked"/>
                    </t>
                    <t t-if="p == 3 and t.stage_id.name != 'BIEN'">
                    <input type="checkbox" name="stage"/>
                    </t>
                  </t>
                  <!--REGULAR-->
                  <t t-if="p == 2">
                    <t t-if=" t.stage_id.name == 'REG'">
                      <input type="checkbox" name="stage" value="checked" checked="checked"/>
                    </t>
                    <t t-if="p == 2 and t.stage_id.name != 'REG'">
                    <input type="checkbox" name="stage"/>
                    </t>
                  </t>
                  <!--MAL-->
                  <t t-if="p == 1">
                    <t t-if=" t.stage_id.name == 'MAL'">
                      <input type="checkbox" name="stage" value="checked" checked="checked"/>
                    </t>
                    <t t-if="p == 1 and t.stage_id.name != 'MAL'">
                    <input type="checkbox" name="stage"/>
                    </t>
                  </t>

                  <t t-set="p" t-value=" p - 1" />
                </td>

                <td style="width:20%">
                  <span t-field="t.description"/>
                </td>
              </tr>
            </table>
            </t>
            </t>

            </div>
            <p style="page-break-after: always;"></p>
            <!--Final del checklist-->

            <!--Comienza las recomndaciones-->
            <span><h2>Recomendaciones</h2></span> 

            <div class="mt16">
            <div class="col-xs-12 mt16" style="background:#FF0000">
              <h3 style="font-weight: bold; font-style:italic; margin-top:0; margin-bottom:0; color:#FFFFFF;">
              <span > Necesidad de correcciones (Urgencias ALTA) </span>
              </h3>
            </div>
            <t t-foreach="o.tasks" t-as="t">
            <t t-if=" t.stage_id.name == 'MAL'">
            <table style="width:100%;">
            <tr>
            <span t-field="t.description"/>
            </tr>
            </table>
            </t>
            </t>
            </div>

            <div class="mt16">
            <div class="col-xs-12 mt16" style="background:#FF9900">
              <h3 style="font-weight: bold; font-style:italic; margin-top:0; margin-bottom:0; color:#FFFFFF;">
              <span > Necesidad de correcciones (Urgencia MEDIA) </span>
              </h3>
            </div>
            <t t-foreach="o.tasks" t-as="t">
            <t t-if=" t.stage_id.name == 'REG'">
            <table style="width:100%;">
            <tr>
            <span t-field="t.description"/>
            </tr>
            </table>
            </t>
            </t>
            </div>

            <div class="mt16">
            <div class="col-xs-12 mt16" style="background:#339900">
              <h3 style="font-weight: bold; font-style:italic; margin-top:0; margin-bottom:0; color:#FFFFFF;">
              <span > Necesidad de correcciones (Urgencia BAJA) </span>
              </h3>
            </div>
            <t t-foreach="o.tasks" t-as="t">
            <t t-if=" t.stage_id.name == 'BIEN'">
            <table style="width:100%;">
            <tr>
            <span t-field="t.description"/>
            </tr>
            </table>
            </t>
            </t>
            </div>
            


            <div class="mt32 mb32">
              <table  style="border: 1px solid black; width:100%;" >
                <tr class="border-black">
                  <td style="border: 1px solid black;">
                    <span>Firma Cliente:</span>
                    <img t-att-src="'data:image/png;base64,%s' % o.signature_image_customer" style="max-height: 100px;"/>
                  </td>
                  <td style="border: 1px solid black;">
                    <span>Firma Responsable:</span>
                    <img t-att-src="'data:image/png;base64,%s' % o.signature_image_responsible" style="max-height: 100px;"/>
                  </td>
                  <td style="border: 1px solid black;">
                    <span>Firma Técnico:</span>
                    <img t-att-src="'data:image/png;base64,%s' % o.signature_image_technician" style="max-height: 100px;"/>
                  </td>
                </tr>
              </table>
            </div>
            </div>
          </t>
        </t>
    </template>
</data>
</openerp>
